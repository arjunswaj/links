<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>magicsuggest.js - RDoc Documentation</title>

<link href="../../../fonts.css" rel="stylesheet">
<link href="../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/navigation.js"></script>
<script src="../../../js/search_index.js"></script>
<script src="../../../js/search.js"></script>
<script src="../../../js/searcher.js"></script>
<script src="../../../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../README_rdoc.html">README</a>
  
    <li><a href="../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../app/assets/javascripts/bookmark_form_js.html">bookmark_form.js</a>
  
    <li><a href="../../../app/assets/javascripts/bookmarklet_js.html">bookmarklet.js</a>
  
    <li><a href="../../../app/assets/javascripts/bookmarks_js.html">bookmarks.js</a>
  
    <li><a href="../../../app/assets/javascripts/bootstrap_js_coffee.html">bootstrap.js.coffee</a>
  
    <li><a href="../../../app/assets/javascripts/delicious_js_coffee.html">delicious.js.coffee</a>
  
    <li><a href="../../../app/assets/javascripts/groups_js_coffee.html">groups.js.coffee</a>
  
    <li><a href="../../../app/assets/javascripts/magicsuggest_js.html">magicsuggest.js</a>
  
    <li><a href="../../../app/assets/javascripts/pages_js_coffee.html">pages.js.coffee</a>
  
    <li><a href="../../../app/assets/javascripts/searches_js.html">searches.js</a>
  
    <li><a href="../../../app/assets/javascripts/urls_js_coffee.html">urls.js.coffee</a>
  
    <li><a href="../../../app/assets/javascripts/users_js_coffee.html">users.js.coffee</a>
  
    <li><a href="../../../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../../../app/assets/stylesheets/bookmarks_css_scss.html">bookmarks.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/bootstrap_and_overrides_css_less.html">bootstrap_and_overrides.css.less</a>
  
    <li><a href="../../../app/assets/stylesheets/delicious_css_scss.html">delicious.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/groups_css_scss.html">groups.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/magicsuggest_css.html">magicsuggest.css</a>
  
    <li><a href="../../../app/assets/stylesheets/pages_css_scss.html">pages.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/scaffolds_css_scss.html">scaffolds.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/searches_css_scss.html">searches.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/urls_css_scss.html">urls.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/users_css_scss.html">users.css.scss</a>
  
    <li><a href="../../../app/views/bookmarks/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../app/views/bookmarks/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../app/views/groups/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../app/views/groups/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../app/views/urls/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../app/views/urls/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../db/production_sqlite3.html">production.sqlite3</a>
  
    <li><a href="../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../log/passenger_3000_log.html">passenger.3000.log</a>
  
    <li><a href="../../../log/passenger_3000_pid.html">passenger.3000.pid</a>
  
    <li><a href="../../../log/passenger_3000_pid_lock.html">passenger.3000.pid.lock</a>
  
    <li><a href="../../../log/passenger_3001_pid_lock.html">passenger.3001.pid.lock</a>
  
    <li><a href="../../../log/production_log.html">production.log</a>
  
    <li><a href="../../../log/test_log.html">test.log</a>
  
    <li><a href="../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../tmp/pids/passenger_3000_pid_lock.html">passenger.3000.pid.lock</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page app/assets/javascripts/magicsuggest.js">

<pre>Multiple Selection Component for Bootstrap
Check nicolasbize.github.io/magicsuggest/ for latest updates.

Author:       Nicolas Bize
Created:      Feb 8th 2013
Last Updated: May 22nd 2014
Version:      2.0.4
Licence:      MagicSuggest is licenced under MIT licence (http://opensource.org/licenses/MIT)</pre>

<p>(function($) {</p>

<pre class="ruby"> <span class="ruby-string">&quot;use strict&quot;</span>;
 <span class="ruby-identifier">var</span> <span class="ruby-constant">MagicSuggest</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>)
 {
     <span class="ruby-identifier">var</span> <span class="ruby-identifier">ms</span> = <span class="ruby-identifier">this</span>;

        <span class="ruby-constant">Initializes</span> <span class="ruby-identifier">the</span> <span class="ruby-constant">MagicSuggest</span> <span class="ruby-identifier">component</span>
       <span class="ruby-regexp">/
     var defaults = {
         /</span><span class="ruby-operator">**</span><span class="ruby-operator">**</span><span class="ruby-operator">**</span><span class="ruby-operator">**</span><span class="ruby-operator">**</span>  <span class="ruby-constant">CONFIGURATION</span> <span class="ruby-constant">PROPERTIES</span>              
         <span class="ruby-regexp">/**
            Restricts or allows the user to validate typed entries.
            Defaults to true.
           /</span>
         <span class="ruby-identifier">allowFreeEntries</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,

         <span class="ruby-regexp">/**
            A custom CSS class to apply to the field&#39;s underlying element.
           /</span>
         <span class="ruby-identifier">cls</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,

         <span class="ruby-regexp">/**
            JSON Data source used to populate the combo box. 3 options are available here:
            No Data Source (default)
               When left null, the combo box will not suggest anything. It can still enable the user to enter
               multiple entries if allowFreeEntries is * set to true (default).
            Static Source
               You can pass an array of JSON objects, an array of strings or even a single CSV string as the
               data source.For ex. data: [* {id:0,name:&quot;Paris&quot;}, {id: 1, name: &quot;New York&quot;}]
               You can also pass any json object with the results property containing the json array.
            Url
                You can pass the url from which the component will fetch its JSON data.Data will be fetched
                using a POST ajax request that will * include the entered text as &#39;query&#39; parameter. The results
                fetched from the server can be:
                - an array of JSON objects (ex: [{id:...,name:...},{...}])
                - a string containing an array of JSON objects ready to be parsed (ex: &quot;[{id:...,name:...},{...}]&quot;)
                - a JSON object whose data will be contained in the results property
                 (ex: {results: [{id:...,name:...},{...}]
            Function
                You can pass a function which returns an array of JSON objects  (ex: [{id:...,name:...},{...}])
                The function can return the JSON data or it can use the first argument as function to handle the data.
                Only one (callback function or return value) is needed for the function to succeed.
                See the following example:
                function (response) { var myjson = [{name: &#39;test&#39;, id: 1}]; response(myjson); return myjson; }
           /</span>
         <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            Additional parameters to the ajax call
           /</span>
         <span class="ruby-identifier">dataUrlParams</span><span class="ruby-operator">:</span> {},

         <span class="ruby-regexp">/**
            Start the component in a disabled state.
           /</span>
         <span class="ruby-identifier">disabled</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            name of JSON object property displayed in the combo list
           /</span>
         <span class="ruby-identifier">displayField</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;name&#39;</span>,

         <span class="ruby-regexp">/**
            Set to false if you only want mouse interaction. In that case the combo will
            automatically expand on focus.
           /</span>
         <span class="ruby-identifier">editable</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,

         <span class="ruby-regexp">/**
            Set starting state for combo.
           /</span>
         <span class="ruby-identifier">expanded</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Automatically expands combo on focus.
           /</span>
         <span class="ruby-identifier">expandOnFocus</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            JSON property by which the list should be grouped
           /</span>
         <span class="ruby-identifier">groupBy</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            Set to true to hide the trigger on the right
           /</span>
         <span class="ruby-identifier">hideTrigger</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Set to true to highlight search input within displayed suggestions
           /</span>
         <span class="ruby-identifier">highlight</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,

         <span class="ruby-regexp">/**
            A custom ID for this component
           /</span>
         <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            A class that is added to the info message appearing on the top-right part of the component
           /</span>
         <span class="ruby-identifier">infoMsgCls</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,

         <span class="ruby-regexp">/**
            Additional parameters passed out to the INPUT tag. Enables usage of AngularJS&#39;s custom tags for ex.
           /</span>
         <span class="ruby-identifier">inputCfg</span><span class="ruby-operator">:</span> {},

         <span class="ruby-regexp">/**
            The class that is applied to show that the field is invalid
           /</span>
         <span class="ruby-identifier">invalidCls</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-inv&#39;</span>,

         <span class="ruby-regexp">/**
            Set to true to filter data results according to case. Useless if the data is fetched remotely
           /</span>
         <span class="ruby-identifier">matchCase</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-node">/**
            Once expanded, the combo&#39;s height will take as much room as the # of available results.
               In case there are too many results displayed, this will fix the drop down height.
           /</span>
         <span class="ruby-identifier">maxDropHeight</span><span class="ruby-operator">:</span> <span class="ruby-value">290</span>,

         <span class="ruby-regexp">/**
            Defines how long the user free entry can be. Set to null for no limit.
           /</span>
         <span class="ruby-identifier">maxEntryLength</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            A function that defines the helper text when the max entry length has been surpassed.
           /</span>
         <span class="ruby-identifier">maxEntryRenderer</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">v</span>) {
             <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;Please reduce your entry by &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; character&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;s&#39;</span><span class="ruby-operator">:</span><span class="ruby-string">&#39;&#39;</span>);
         },

         <span class="ruby-regexp">/**
            The maximum number of results displayed in the combo drop down at once.
           /</span>
         <span class="ruby-identifier">maxSuggestions</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            The maximum number of items the user can select if multiple selection is allowed.
               Set to null to remove the limit.
           /</span>
         <span class="ruby-identifier">maxSelection</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>,

         <span class="ruby-regexp">/**
            A function that defines the helper text when the max selection amount has been reached. The function has a single
               parameter which is the number of selected elements.
           /</span>
         <span class="ruby-identifier">maxSelectionRenderer</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">v</span>) {
             <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;You cannot choose more than &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; item&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;s&#39;</span><span class="ruby-operator">:</span><span class="ruby-string">&#39;&#39;</span>);
         },

         <span class="ruby-regexp">/**
            The method used by the ajax request.
           /</span>
         <span class="ruby-identifier">method</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;POST&#39;</span>,

         <span class="ruby-regexp">/**
            The minimum number of characters the user must type before the combo expands and offers suggestions.
           /</span>
         <span class="ruby-identifier">minChars</span><span class="ruby-operator">:</span> <span class="ruby-value">0</span>,

         <span class="ruby-regexp">/**
            A function that defines the helper text when not enough letters are set. The function has a single
               parameter which is the difference between the required amount of letters and the current one.
           /</span>
         <span class="ruby-identifier">minCharsRenderer</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">v</span>) {
             <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;Please type &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; more character&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;s&#39;</span><span class="ruby-operator">:</span><span class="ruby-string">&#39;&#39;</span>);
         },

         <span class="ruby-regexp">/**
            Whether or not sorting /</span> <span class="ruby-identifier">filtering</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">done</span> <span class="ruby-identifier">remotely</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">locally</span>.
            <span class="ruby-constant">Use</span> <span class="ruby-identifier">either</span> <span class="ruby-string">&#39;local&#39;</span> <span class="ruby-keyword">or</span> <span class="ruby-string">&#39;remote&#39;</span>
           <span class="ruby-regexp">/
         mode: &#39;local&#39;,

         /</span><span class="ruby-operator">**</span>
            <span class="ruby-constant">The</span> <span class="ruby-identifier">name</span> <span class="ruby-identifier">used</span> <span class="ruby-identifier">as</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">form</span> <span class="ruby-identifier">element</span>.
           <span class="ruby-operator">/</span>
         <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            The text displayed when there are no suggestions.
           /</span>
         <span class="ruby-identifier">noSuggestionText</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;No suggestions&#39;</span>,

         <span class="ruby-regexp">/**
            The default placeholder text when nothing has been entered
           /</span>
         <span class="ruby-identifier">placeholder</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Type or click here&#39;</span>,

         <span class="ruby-regexp">/**
            If a single suggestion comes out, it is preselected.
           /</span>
         <span class="ruby-identifier">autoSelect</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,

         <span class="ruby-regexp">/**
            A function used to define how the items will be presented in the combo
           /</span>
         <span class="ruby-identifier">renderer</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            Whether or not this field should be required
           /</span>
         <span class="ruby-identifier">required</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Set to true to render selection as comma separated string
           /</span>
         <span class="ruby-identifier">resultAsString</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Name of JSON object property that represents the list of suggested objects
           /</span>
         <span class="ruby-identifier">resultsField</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;results&#39;</span>,

         <span class="ruby-regexp">/**
            A custom CSS class to add to a selected item
           /</span>
         <span class="ruby-identifier">selectionCls</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,

         <span class="ruby-regexp">/**
            Where the selected items will be displayed. Only &#39;right&#39;, &#39;bottom&#39; and &#39;inner&#39; are valid values
           /</span>
         <span class="ruby-identifier">selectionPosition</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;inner&#39;</span>,

         <span class="ruby-regexp">/**
            A function used to define how the items will be presented in the tag list
           /</span>
         <span class="ruby-identifier">selectionRenderer</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            Set to true to stack the selectioned items when positioned on the bottom
               Requires the selectionPosition to be set to &#39;bottom&#39;
           /</span>
         <span class="ruby-identifier">selectionStacked</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Direction used for sorting. Only &#39;asc&#39; and &#39;desc&#39; are valid values
           /</span>
         <span class="ruby-identifier">sortDir</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;asc&#39;</span>,

         <span class="ruby-regexp">/**
            name of JSON object property for local result sorting.
               Leave null if you do not wish the results to be ordered or if they are already ordered remotely.
           /</span>
         <span class="ruby-identifier">sortOrder</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            If set to true, suggestions will have to start by user input (and not simply contain it as a substring)
           /</span>
         <span class="ruby-identifier">strictSuggest</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            Custom style added to the component container.
           /</span>
         <span class="ruby-identifier">style</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,

         <span class="ruby-regexp">/**
            If set to true, the combo will expand /</span> <span class="ruby-identifier">collapse</span> <span class="ruby-keyword">when</span> <span class="ruby-identifier">clicked</span> <span class="ruby-identifier">upon</span>
           <span class="ruby-regexp">/
         toggleOnClick: false,

         /</span><span class="ruby-operator">**</span>
            <span class="ruby-constant">Amount</span> (<span class="ruby-keyword">in</span> <span class="ruby-identifier">ms</span>) <span class="ruby-identifier">between</span> <span class="ruby-identifier">keyboard</span> <span class="ruby-identifier">registers</span>.
           <span class="ruby-operator">/</span>
         <span class="ruby-identifier">typeDelay</span><span class="ruby-operator">:</span> <span class="ruby-value">400</span>,

         <span class="ruby-regexp">/**
            If set to true, tab won&#39;t blur the component but will be registered as the ENTER key
           /</span>
         <span class="ruby-identifier">useTabKey</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            If set to true, using comma will validate the user&#39;s choice
           /</span>
         <span class="ruby-identifier">useCommaKey</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,

         <span class="ruby-regexp">/**
            Determines whether or not the results will be displayed with a zebra table style
           /</span>
         <span class="ruby-identifier">useZebraStyle</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

         <span class="ruby-regexp">/**
            initial value for the field
           /</span>
         <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            name of JSON object property that represents its underlying value
           /</span>
         <span class="ruby-identifier">valueField</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;id&#39;</span>,

         <span class="ruby-regexp">/**
            regular expression to validate the values against
           /</span>
         <span class="ruby-identifier">vregex</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>,

         <span class="ruby-regexp">/**
            type to validate against
           /</span>
         <span class="ruby-identifier">vtype</span><span class="ruby-operator">:</span> <span class="ruby-identifier">null</span>
     };

     <span class="ruby-identifier">var</span> <span class="ruby-identifier">conf</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>({},<span class="ruby-identifier">options</span>);
     <span class="ruby-identifier">var</span> <span class="ruby-identifier">cfg</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>(<span class="ruby-keyword">true</span>, {}, <span class="ruby-identifier">defaults</span>, <span class="ruby-identifier">conf</span>);

     <span class="ruby-regexp">/**********  PUBLIC METHODS ************/</span>
     <span class="ruby-regexp">/**
        Add one or multiple json items to the current selection
        @param items - json object or array of json objects
        @param isSilent - (optional) set to true to suppress &#39;selectionchange&#39; event from being triggered
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">addToSelection</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">isSilent</span>)
     {
         <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>) {
             <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$.</span><span class="ruby-identifier">isArray</span>(<span class="ruby-identifier">items</span>)) {
                 <span class="ruby-identifier">items</span> = [<span class="ruby-identifier">items</span>];
             }
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">valuechanged</span> = <span class="ruby-keyword">false</span>;
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">json</span>) {
                 <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$.</span><span class="ruby-identifier">inArray</span>(<span class="ruby-identifier">json</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>], <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getValue</span>()) <span class="ruby-operator">===</span> <span class="ruby-value">-1</span>) {
                     <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">json</span>);
                     <span class="ruby-identifier">valuechanged</span> = <span class="ruby-keyword">true</span>;
                 }
             });
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">valuechanged</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
                 <span class="ruby-identifier">this</span>.<span class="ruby-identifier">empty</span>();
                 <span class="ruby-keyword">if</span> (<span class="ruby-identifier">isSilent</span> <span class="ruby-operator">!=</span>= <span class="ruby-keyword">true</span>) {
                     $(<span class="ruby-identifier">this</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;selectionchange&#39;</span>, [<span class="ruby-identifier">this</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getSelection</span>()]);
                 }
             }
         }
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">attr</span>(<span class="ruby-string">&#39;placeholder&#39;</span>, (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getValue</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">placeholder</span>);
     };

     <span class="ruby-regexp">/**
        Clears the current selection
        @param isSilent - (optional) set to true to suppress &#39;selectionchange&#39; event from being triggered
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">clear</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">isSilent</span>)
     {
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">removeFromSelection</span>(<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>), <span class="ruby-identifier">isSilent</span>); <span class="ruby-regexp">//</span> <span class="ruby-identifier">clone</span> <span class="ruby-identifier">array</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">avoid</span> <span class="ruby-identifier">concurrency</span> <span class="ruby-identifier">issues</span>
     };

     <span class="ruby-regexp">/**
        Collapse the drop down part of the combo
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">collapse</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
             <span class="ruby-identifier">this</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">detach</span>();
             <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> = <span class="ruby-keyword">false</span>;
             $(<span class="ruby-identifier">this</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;collapse&#39;</span>, [<span class="ruby-identifier">this</span>]);
         }
     };

     <span class="ruby-regexp">/**
        Set the component in a disabled state.
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">disable</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&#39;ms-ctn-disabled&#39;</span>);
         <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span> = <span class="ruby-keyword">true</span>;
         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">attr</span>(<span class="ruby-string">&#39;disabled&#39;</span>, <span class="ruby-keyword">true</span>);
     };

     <span class="ruby-regexp">/**
        Empties out the combo user text
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">empty</span> = <span class="ruby-identifier">function</span>(){
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>(<span class="ruby-string">&#39;&#39;</span>);
     };

     <span class="ruby-regexp">/**
        Set the component in a enable state.
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">enable</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">removeClass</span>(<span class="ruby-string">&#39;ms-ctn-disabled&#39;</span>);
         <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span> = <span class="ruby-keyword">false</span>;
         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">attr</span>(<span class="ruby-string">&#39;disabled&#39;</span>, <span class="ruby-keyword">false</span>);
     };

     <span class="ruby-regexp">/**
        Expand the drop drown part of the combo.
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">expand</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">this</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">children</span>().<span class="ruby-identifier">size</span>() <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)) {
             <span class="ruby-identifier">this</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">appendTo</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">container</span>);
             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
             <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> = <span class="ruby-keyword">true</span>;
             $(<span class="ruby-identifier">this</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;expand&#39;</span>, [<span class="ruby-identifier">this</span>]);
         }
     };

     <span class="ruby-regexp">/**
        Retrieve component enabled status
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">isDisabled</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span>;
     };

     <span class="ruby-regexp">/**
        Checks whether the field is valid or not
        @return {boolean}
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">isValid</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-identifier">var</span> <span class="ruby-identifier">valid</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">required</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>;
         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vtype</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vregex</span>){
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">_selection</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">item</span>){
                 <span class="ruby-identifier">valid</span> = <span class="ruby-identifier">valid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_validateSingleItem</span>(<span class="ruby-identifier">item</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>]);
             });
         }
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">valid</span>;
     };

     <span class="ruby-regexp">/**
        Gets the data params for current ajax request
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getDataUrlParams</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">dataUrlParams</span>;
     };

     <span class="ruby-regexp">/**
        Gets the name given to the form input
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getName</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span>;
     };

     <span class="ruby-regexp">/**
        Retrieve an array of selected json objects
        @return {Array}
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getSelection</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">_selection</span>;
     };

     <span class="ruby-regexp">/**
        Retrieve the current text entered by the user
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getRawValue</span> = <span class="ruby-identifier">function</span>(){
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>();
     };

     <span class="ruby-regexp">/**
        Retrieve an array of selected values
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getValue</span> = <span class="ruby-identifier">function</span>()
     {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">$.</span><span class="ruby-identifier">map</span>(<span class="ruby-identifier">_selection</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">o</span>) {
             <span class="ruby-keyword">return</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>];
         });
     };

     <span class="ruby-regexp">/**
        Remove one or multiples json items from the current selection
        @param items - json object or array of json objects
        @param isSilent - (optional) set to true to suppress &#39;selectionchange&#39; event from being triggered
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">removeFromSelection</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">isSilent</span>)
     {
         <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$.</span><span class="ruby-identifier">isArray</span>(<span class="ruby-identifier">items</span>)) {
             <span class="ruby-identifier">items</span> = [<span class="ruby-identifier">items</span>];
         }
         <span class="ruby-identifier">var</span> <span class="ruby-identifier">valuechanged</span> = <span class="ruby-keyword">false</span>;
         <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">json</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">i</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">inArray</span>(<span class="ruby-identifier">json</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>], <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getValue</span>());
             <span class="ruby-keyword">if</span> (<span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>) {
                 <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">splice</span>(<span class="ruby-identifier">i</span>, <span class="ruby-value">1</span>);
                 <span class="ruby-identifier">valuechanged</span> = <span class="ruby-keyword">true</span>;
             }
         });
         <span class="ruby-keyword">if</span> (<span class="ruby-identifier">valuechanged</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">isSilent</span> <span class="ruby-operator">!=</span>= <span class="ruby-keyword">true</span>){
                 $(<span class="ruby-identifier">this</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;selectionchange&#39;</span>, [<span class="ruby-identifier">this</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getSelection</span>()]);
             }
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expandOnFocus</span>){
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
             }
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span>) {
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
             }
         }
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">attr</span>(<span class="ruby-string">&#39;placeholder&#39;</span>, (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getValue</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">placeholder</span>);
     };

     <span class="ruby-regexp">/**
        Get current data
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getData</span> = <span class="ruby-identifier">function</span>(){
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">_cbData</span>;
     };

     <span class="ruby-regexp">/**
        Set up some combo data after it has been rendered
        @param data
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">setData</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">data</span>){
         <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>;
         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
     };

     <span class="ruby-regexp">/**
        Sets the name for the input field so it can be fetched in the form
        @param name
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">setName</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">name</span>){
         <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>;
         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">name</span>){
             <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">indexOf</span>(<span class="ruby-string">&#39;[]&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;[]&#39;</span>;
         }
         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span>){
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span>.<span class="ruby-identifier">children</span>(), <span class="ruby-identifier">function</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">el</span>){
                 <span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span>;
             });
         }
     };

     <span class="ruby-regexp">/**
        Sets the current selection with the JSON items provided
        @param items
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">setSelection</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">items</span>){
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">clear</span>();
         <span class="ruby-identifier">this</span>.<span class="ruby-identifier">addToSelection</span>(<span class="ruby-identifier">items</span>);
     };

     <span class="ruby-regexp">/**
        Sets a value for the combo box. Value must be an array of values with data type matching valueField one.
        @param data
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">setValue</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">values</span>)
     {
         <span class="ruby-identifier">var</span> <span class="ruby-identifier">items</span> = [];

         <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">values</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">value</span>) {
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">first</span> <span class="ruby-identifier">try</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">see</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">we</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">full</span> <span class="ruby-identifier">objects</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">our</span> <span class="ruby-identifier">data</span> <span class="ruby-identifier">set</span>
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">found</span> = <span class="ruby-keyword">false</span>;
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">_cbData</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">i</span>,<span class="ruby-identifier">item</span>){
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">item</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span>){
                     <span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">item</span>);
                     <span class="ruby-identifier">found</span> = <span class="ruby-keyword">true</span>;
                     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>;
                 }
             });
             <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">found</span>){
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">value</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;object&#39;</span>){
                     <span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">value</span>);
                 } <span class="ruby-keyword">else</span> {
                     <span class="ruby-identifier">var</span> <span class="ruby-identifier">json</span> = {};
                     <span class="ruby-identifier">json</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>] = <span class="ruby-identifier">value</span>;
                     <span class="ruby-identifier">json</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>] = <span class="ruby-identifier">value</span>;
                     <span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">json</span>);
                 }
             }
         });
         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
             <span class="ruby-identifier">this</span>.<span class="ruby-identifier">addToSelection</span>(<span class="ruby-identifier">items</span>);
         }
     };

     <span class="ruby-regexp">/**
        Sets data params for subsequent ajax requests
        @param params
       /</span>
     <span class="ruby-identifier">this</span>.<span class="ruby-identifier">setDataUrlParams</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">params</span>)
     {
         <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">dataUrlParams</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>({},<span class="ruby-identifier">params</span>);
     };

     <span class="ruby-regexp">/**********  PRIVATE ************/</span>
     <span class="ruby-identifier">var</span> <span class="ruby-identifier">_selection</span> = [],      <span class="ruby-regexp">//</span> <span class="ruby-identifier">selected</span> <span class="ruby-identifier">objects</span>
         <span class="ruby-identifier">_comboItemHeight</span> = <span class="ruby-value">0</span>, <span class="ruby-regexp">//</span> <span class="ruby-identifier">height</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">each</span> <span class="ruby-identifier">combo</span> <span class="ruby-identifier">item</span>.
         <span class="ruby-identifier">_timer</span>,
         <span class="ruby-identifier">_hasFocus</span> = <span class="ruby-keyword">false</span>,
         <span class="ruby-identifier">_groups</span> = <span class="ruby-identifier">null</span>,
         <span class="ruby-identifier">_cbData</span> = [],
         <span class="ruby-identifier">_ctrlDown</span> = <span class="ruby-keyword">false</span>;

     <span class="ruby-identifier">var</span> <span class="ruby-keyword">self</span> = {

         <span class="ruby-regexp">/**
            Empties the result container and refills it with the array of json results in input
            @private
           /</span>
         <span class="ruby-identifier">_displaySuggestions</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">data</span>) {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">show</span>();
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">empty</span>();

             <span class="ruby-identifier">var</span> <span class="ruby-identifier">resHeight</span> = <span class="ruby-value">0</span>, <span class="ruby-regexp">//</span> <span class="ruby-identifier">total</span> <span class="ruby-identifier">height</span> <span class="ruby-identifier">taken</span> <span class="ruby-identifier">by</span> <span class="ruby-identifier">displayed</span> <span class="ruby-identifier">results</span>.
                 <span class="ruby-identifier">nbGroups</span> = <span class="ruby-value">0</span>;

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_groups</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">null</span>) {
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderComboItems</span>(<span class="ruby-identifier">data</span>);
                 <span class="ruby-identifier">resHeight</span> = <span class="ruby-identifier">_comboItemHeight</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span>;
             }
             <span class="ruby-keyword">else</span> {
                 <span class="ruby-keyword">for</span>(<span class="ruby-identifier">var</span> <span class="ruby-identifier">grpName</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">_groups</span>) {
                     <span class="ruby-identifier">nbGroups</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>;
                     $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                         <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-res-group&#39;</span>,
                         <span class="ruby-identifier">html</span><span class="ruby-operator">:</span> <span class="ruby-identifier">grpName</span>
                     }).<span class="ruby-identifier">appendTo</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>);
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderComboItems</span>(<span class="ruby-identifier">_groups</span>[<span class="ruby-identifier">grpName</span>].<span class="ruby-identifier">items</span>, <span class="ruby-keyword">true</span>);
                 }
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">_groupItemHeight</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-res-group&#39;</span>).<span class="ruby-identifier">outerHeight</span>();
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_groupItemHeight</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
                   <span class="ruby-identifier">var</span> <span class="ruby-identifier">tmpResHeight</span> = <span class="ruby-identifier">nbGroups</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">_groupItemHeight</span>;
                   <span class="ruby-identifier">resHeight</span> = (<span class="ruby-identifier">_comboItemHeight</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">tmpResHeight</span>;
                 } <span class="ruby-keyword">else</span> {
                   <span class="ruby-identifier">resHeight</span> = <span class="ruby-identifier">_comboItemHeight</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">nbGroups</span>);
                 }
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">resHeight</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">height</span>() <span class="ruby-operator">||</span> <span class="ruby-identifier">resHeight</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxDropHeight</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">height</span>(<span class="ruby-identifier">resHeight</span>);
             }
             <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">resHeight</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">height</span>() <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">resHeight</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxDropHeight</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">height</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxDropHeight</span>);
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">autoSelect</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">children</span>().<span class="ruby-identifier">filter</span>(<span class="ruby-string">&#39;:last&#39;</span>).<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&#39;ms-res-item-active&#39;</span>);
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>() <span class="ruby-operator">!=</span>= <span class="ruby-string">&quot;&quot;</span>) {
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">noSuggestionText</span>);
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span>){
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">hide</span>();
             }
         },

         <span class="ruby-regexp">/**
            Returns an array of json objects from an array of strings.
            @private
           /</span>
         <span class="ruby-identifier">_getEntriesFromStringArray</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">data</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">json</span> = [];
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">s</span>) {
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">entry</span> = {};
                 <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>] = <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>] = <span class="ruby-identifier">$.</span><span class="ruby-identifier">trim</span>(<span class="ruby-identifier">s</span>);
                 <span class="ruby-identifier">json</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">entry</span>);
             });
             <span class="ruby-keyword">return</span> <span class="ruby-identifier">json</span>;
         },

         <span class="ruby-regexp">/**
            Replaces html with highlighted html according to case
            @param html
            @private
           /</span>
         <span class="ruby-identifier">_highlightSuggestion</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">html</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">q</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>();
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">q</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span>) {
                 <span class="ruby-keyword">return</span> <span class="ruby-identifier">html</span>; <span class="ruby-regexp">//</span> <span class="ruby-identifier">nothing</span> <span class="ruby-identifier">entered</span> <span class="ruby-identifier">as</span> <span class="ruby-identifier">input</span>
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">matchCase</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                 <span class="ruby-identifier">html</span> = <span class="ruby-identifier">html</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new</span> <span class="ruby-constant">RegExp</span>(<span class="ruby-string">&#39;(&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;)(?!([^&lt;]+)?&gt;)&#39;</span>,<span class="ruby-string">&#39;g&#39;</span>), <span class="ruby-string">&#39;&lt;em&gt;$1&lt;/em&gt;&#39;</span>);
             }
             <span class="ruby-keyword">else</span> {
                 <span class="ruby-identifier">html</span> = <span class="ruby-identifier">html</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new</span> <span class="ruby-constant">RegExp</span>(<span class="ruby-string">&#39;(&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;)(?!([^&lt;]+)?&gt;)&#39;</span>,<span class="ruby-string">&#39;gi&#39;</span>), <span class="ruby-string">&#39;&lt;em&gt;$1&lt;/em&gt;&#39;</span>);
             }
             <span class="ruby-keyword">return</span> <span class="ruby-identifier">html</span>;
         },

         <span class="ruby-regexp">/**
            Moves the selected cursor amongst the list item
            @param dir - &#39;up&#39; or &#39;down&#39;
            @private
           /</span>
         <span class="ruby-identifier">_moveSelectedRow</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">dir</span>) {
             <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
             }
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">list</span>, <span class="ruby-identifier">start</span>, <span class="ruby-identifier">active</span>, <span class="ruby-identifier">scrollPos</span>;
             <span class="ruby-identifier">list</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&quot;.ms-res-item&quot;</span>);
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">dir</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;down&#39;</span>) {
                 <span class="ruby-identifier">start</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">eq</span>(<span class="ruby-value">0</span>);
             }
             <span class="ruby-keyword">else</span> {
                 <span class="ruby-identifier">start</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-string">&#39;:last&#39;</span>);
             }
             <span class="ruby-identifier">active</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-res-item-active:first&#39;</span>);
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">active</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">dir</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;down&#39;</span>) {
                     <span class="ruby-identifier">start</span> = <span class="ruby-identifier">active</span>.<span class="ruby-identifier">nextAll</span>(<span class="ruby-string">&#39;.ms-res-item&#39;</span>).<span class="ruby-identifier">first</span>();
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">start</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span>) {
                         <span class="ruby-identifier">start</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">eq</span>(<span class="ruby-value">0</span>);
                     }
                     <span class="ruby-identifier">scrollPos</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>();
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>(<span class="ruby-value">0</span>);
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">start</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">offsetTop</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">start</span>.<span class="ruby-identifier">outerHeight</span>() <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">height</span>()) {
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>(<span class="ruby-identifier">scrollPos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">_comboItemHeight</span>);
                     }
                 }
                 <span class="ruby-keyword">else</span> {
                     <span class="ruby-identifier">start</span> = <span class="ruby-identifier">active</span>.<span class="ruby-identifier">prevAll</span>(<span class="ruby-string">&#39;.ms-res-item&#39;</span>).<span class="ruby-identifier">first</span>();
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">start</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span>) {
                         <span class="ruby-identifier">start</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-string">&#39;:last&#39;</span>);
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>(<span class="ruby-identifier">_comboItemHeight</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">length</span>);
                     }
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">start</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">offsetTop</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>()) {
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">scrollTop</span>() <span class="ruby-operator">-</span> <span class="ruby-identifier">_comboItemHeight</span>);
                     }
                 }
             }
             <span class="ruby-identifier">list</span>.<span class="ruby-identifier">removeClass</span>(<span class="ruby-string">&quot;ms-res-item-active&quot;</span>);
             <span class="ruby-identifier">start</span>.<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&quot;ms-res-item-active&quot;</span>);
         },

         <span class="ruby-regexp">/**
            According to given data and query, sort and add suggestions in their container
            @private
           /</span>
         <span class="ruby-identifier">_processSuggestions</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">source</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">json</span> = <span class="ruby-identifier">null</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">source</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">data</span>;
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">data</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">data</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;function&#39;</span>){
                     <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">ms</span>, <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>());
                 }
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">data</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;string&#39;</span>) { <span class="ruby-regexp">//</span> <span class="ruby-identifier">get</span> <span class="ruby-identifier">results</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">ajax</span>
                     $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;beforeload&#39;</span>, [<span class="ruby-identifier">ms</span>]);
                     <span class="ruby-identifier">var</span> <span class="ruby-identifier">params</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>({<span class="ruby-identifier">query</span><span class="ruby-operator">:</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>()}, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">dataUrlParams</span>);
                     <span class="ruby-identifier">$.</span><span class="ruby-identifier">ajax</span>({
                         <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">method</span>,
                         <span class="ruby-identifier">url</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>,
                         <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>,
                         <span class="ruby-identifier">success</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">asyncData</span>){
                             <span class="ruby-identifier">json</span> = <span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">asyncData</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;string&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">asyncData</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">asyncData</span>;
                             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>(<span class="ruby-identifier">json</span>);
                             $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;load&#39;</span>, [<span class="ruby-identifier">ms</span>, <span class="ruby-identifier">json</span>]);
                             <span class="ruby-keyword">if</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span>){
                                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">setValue</span>(<span class="ruby-identifier">typeof</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;string&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span>);
                                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
                                 <span class="ruby-identifier">delete</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span>);
                             }
                         },
                         <span class="ruby-identifier">error</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(){
                             <span class="ruby-identifier">throw</span>(<span class="ruby-string">&quot;Could not reach server&quot;</span>);
                         }
                     });
                     <span class="ruby-keyword">return</span>;
                 } <span class="ruby-keyword">else</span> { <span class="ruby-regexp">//</span> <span class="ruby-identifier">results</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">local</span> <span class="ruby-identifier">array</span>
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">data</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;string&#39;</span>) { <span class="ruby-regexp">//</span> <span class="ruby-identifier">results</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">array</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">strings</span>
                         <span class="ruby-identifier">_cbData</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_getEntriesFromStringArray</span>(<span class="ruby-identifier">data</span>);
                     } <span class="ruby-keyword">else</span> { <span class="ruby-regexp">//</span> <span class="ruby-identifier">regular</span> <span class="ruby-identifier">json</span> <span class="ruby-identifier">array</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">json</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">with</span> <span class="ruby-identifier">results</span> <span class="ruby-identifier">property</span>
                         <span class="ruby-identifier">_cbData</span> = <span class="ruby-identifier">data</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">resultsField</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>;
                     }
                 }
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">sortedData</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">mode</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;remote&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">_cbData</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_sortAndTrim</span>(<span class="ruby-identifier">_cbData</span>);
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_displaySuggestions</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">_group</span>(<span class="ruby-identifier">sortedData</span>));

             }
         },

         <span class="ruby-regexp">/**
            Render the component to the given input DOM element
            @private
           /</span>
         <span class="ruby-identifier">_render</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">el</span>) {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">setName</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span>);  <span class="ruby-regexp">//</span> <span class="ruby-identifier">make</span> <span class="ruby-identifier">sure</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">form</span> <span class="ruby-identifier">name</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">correct</span>
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">holds</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">main</span> <span class="ruby-identifier">div</span>, <span class="ruby-identifier">will</span> <span class="ruby-identifier">relay</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">focus</span> <span class="ruby-identifier">events</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">contained</span> <span class="ruby-identifier">input</span> <span class="ruby-identifier">element</span>.
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                 <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-ctn form-control &#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">resultAsString</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;ms-as-string &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">cls</span> <span class="ruby-operator">+</span>
                     (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; ms-ctn-disabled&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">+</span>
                     (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">editable</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; ms-ctn-readonly&#39;</span>) <span class="ruby-operator">+</span>
                     (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">hideTrigger</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; ms-no-trigger&#39;</span>),
                 <span class="ruby-identifier">style</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">style</span>
             });
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">focus</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onFocus</span>, <span class="ruby-identifier">this</span>));
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">blur</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onBlur</span>, <span class="ruby-identifier">this</span>));
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">keydown</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onKeyDown</span>, <span class="ruby-identifier">this</span>));
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">keyup</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onKeyUp</span>, <span class="ruby-identifier">this</span>));

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">holds</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">input</span> <span class="ruby-identifier">field</span>
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span> = $(<span class="ruby-string">&#39;&lt;input/&gt;&#39;</span>, <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>({
                 <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;text&#39;</span>,
                 <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">editable</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; ms-input-readonly&#39;</span>,
                 <span class="ruby-identifier">readonly</span><span class="ruby-operator">:</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">editable</span>,
                 <span class="ruby-identifier">placeholder</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">placeholder</span>,
                 <span class="ruby-identifier">disabled</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span>
             }, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">inputCfg</span>));

             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onInputFocus</span>, <span class="ruby-identifier">this</span>));
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">click</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onInputClick</span>, <span class="ruby-identifier">this</span>));

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">holds</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">suggestions</span>. <span class="ruby-identifier">will</span> <span class="ruby-identifier">always</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">placed</span> <span class="ruby-identifier">on</span> <span class="ruby-identifier">focus</span>
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                 <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-res-ctn dropdown-menu&#39;</span>
             }).<span class="ruby-identifier">height</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxDropHeight</span>);

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">bind</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">onclick</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">mouseover</span> <span class="ruby-identifier">using</span> <span class="ruby-identifier">delegated</span> <span class="ruby-identifier">events</span> (<span class="ruby-identifier">needs</span> <span class="ruby-identifier">jQuery</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1.7</span>)
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">on</span>(<span class="ruby-string">&#39;click&#39;</span>, <span class="ruby-string">&#39;div.ms-res-item&#39;</span>, <span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onComboItemSelected</span>, <span class="ruby-identifier">this</span>));
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">on</span>(<span class="ruby-string">&#39;mouseover&#39;</span>, <span class="ruby-string">&#39;div.ms-res-item&#39;</span>, <span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onComboItemMouseOver</span>, <span class="ruby-identifier">this</span>));

             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                 <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-sel-ctn&#39;</span>
             });
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">click</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onFocus</span>, <span class="ruby-identifier">this</span>));

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>);
             }
             <span class="ruby-keyword">else</span> {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>);
             }

             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span> = $(<span class="ruby-string">&#39;&lt;span/&gt;&#39;</span>, {
                 <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-helper &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">infoMsgCls</span>
             });
             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>();
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>);

             <span class="ruby-regexp">//</span> <span class="ruby-constant">Render</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">whole</span> <span class="ruby-identifier">thing</span>
             $(<span class="ruby-identifier">el</span>).<span class="ruby-identifier">replaceWith</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>);

             <span class="ruby-identifier">switch</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span>) {
                 <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;bottom&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">insertAfter</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>);
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionStacked</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">width</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">width</span>());
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&#39;ms-stacked&#39;</span>);
                     }
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;right&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">insertAfter</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>);
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;float&#39;</span>, <span class="ruby-string">&#39;left&#39;</span>);
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-identifier">default</span><span class="ruby-operator">:</span>
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>);
                     <span class="ruby-keyword">break</span>;
             }

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">holds</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">trigger</span> <span class="ruby-identifier">on</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">right</span> <span class="ruby-identifier">side</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">hideTrigger</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">trigger</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                     <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-trigger&#39;</span>,
                     <span class="ruby-identifier">html</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&lt;div class=&quot;ms-trigger-ico&quot;&gt;&lt;/div&gt;&#39;</span>
                 });
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">trigger</span>.<span class="ruby-identifier">click</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onTriggerClick</span>, <span class="ruby-identifier">this</span>));
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">trigger</span>);
             }

             <span class="ruby-regexp">//</span> <span class="ruby-keyword">do</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">perform</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">initial</span> <span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">we</span> <span class="ruby-identifier">are</span> <span class="ruby-identifier">using</span> <span class="ruby-identifier">ajax</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">we</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">initial</span> <span class="ruby-identifier">values</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>){
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">typeof</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">data</span>) <span class="ruby-operator">===</span> <span class="ruby-string">&#39;string&#39;</span>){
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_asyncValues</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">value</span>;
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
                 } <span class="ruby-keyword">else</span> {
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">setValue</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">value</span>);
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
                 }

             }

             $(<span class="ruby-string">&quot;body&quot;</span>).<span class="ruby-identifier">click</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">hasClass</span>(<span class="ruby-string">&#39;ms-ctn-focus&#39;</span>) <span class="ruby-operator">&amp;&amp;</span>
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">has</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span>.<span class="ruby-identifier">className</span>.<span class="ruby-identifier">indexOf</span>(<span class="ruby-string">&#39;ms-res-item&#39;</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span>.<span class="ruby-identifier">className</span>.<span class="ruby-identifier">indexOf</span>(<span class="ruby-string">&#39;ms-close-btn&#39;</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span>= <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span>) {
                     <span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onBlur</span>();
                 }
             });

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                 <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> = <span class="ruby-keyword">false</span>;
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
             }
         },

         <span class="ruby-identifier">_renderComboItems</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">isGrouped</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">this</span>, <span class="ruby-identifier">html</span> = <span class="ruby-string">&#39;&#39;</span>;
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">value</span>) {
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">displayed</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">renderer</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">renderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>];
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">resultItemEl</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                     <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-res-item &#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">isGrouped</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;ms-res-item-grouped &#39;</span><span class="ruby-operator">:</span><span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">+</span>
                         (<span class="ruby-identifier">index</span> <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">===</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">useZebraStyle</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;ms-res-odd&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>),
                     <span class="ruby-identifier">html</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">highlight</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_highlightSuggestion</span>(<span class="ruby-identifier">displayed</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">displayed</span>,
                     <span class="ruby-string">&#39;data-json&#39;</span><span class="ruby-operator">:</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">stringify</span>(<span class="ruby-identifier">value</span>)
                 });
                 <span class="ruby-identifier">resultItemEl</span>.<span class="ruby-identifier">click</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onComboItemSelected</span>, <span class="ruby-identifier">ref</span>));
                 <span class="ruby-identifier">resultItemEl</span>.<span class="ruby-identifier">mouseover</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onComboItemMouseOver</span>, <span class="ruby-identifier">ref</span>));
                 <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>).<span class="ruby-identifier">append</span>(<span class="ruby-identifier">resultItemEl</span>).<span class="ruby-identifier">html</span>();
             });
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">html</span>);
             <span class="ruby-identifier">_comboItemHeight</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-res-item:first&#39;</span>).<span class="ruby-identifier">outerHeight</span>();
         },

         <span class="ruby-regexp">/**
            Renders the selected items into their container.
            @private
           /</span>
         <span class="ruby-identifier">_renderSelection</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">this</span>, <span class="ruby-identifier">w</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">inputOffset</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">items</span> = [],
                 <span class="ruby-identifier">asText</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">resultAsString</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">_hasFocus</span>;

             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-sel-item&#39;</span>).<span class="ruby-identifier">remove</span>();
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">undefined</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span>.<span class="ruby-identifier">remove</span>();
             }

             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">_selection</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">value</span>){

                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">selectedItemEl</span>, <span class="ruby-identifier">delItemEl</span>,
                     <span class="ruby-identifier">selectedItemHtml</span> = <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionRenderer</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>];

                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">validCls</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_validateSingleItem</span>(<span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>]) <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; ms-sel-invalid&#39;</span>;

                 <span class="ruby-regexp">//</span> <span class="ruby-identifier">tag</span> <span class="ruby-identifier">representing</span> <span class="ruby-identifier">selected</span> <span class="ruby-identifier">value</span>
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">asText</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                     <span class="ruby-identifier">selectedItemEl</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                         <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-sel-item ms-sel-text &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionCls</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">validCls</span>,
                         <span class="ruby-identifier">html</span><span class="ruby-operator">:</span> <span class="ruby-identifier">selectedItemHtml</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">index</span> <span class="ruby-operator">===</span> (<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;,&#39;</span>)
                     }).<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;json&#39;</span>, <span class="ruby-identifier">value</span>);
                 }
                 <span class="ruby-keyword">else</span> {
                     <span class="ruby-identifier">selectedItemEl</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                         <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-sel-item &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionCls</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">validCls</span>,
                         <span class="ruby-identifier">html</span><span class="ruby-operator">:</span> <span class="ruby-identifier">selectedItemHtml</span>
                     }).<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;json&#39;</span>, <span class="ruby-identifier">value</span>);

                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">disabled</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span>){
                         <span class="ruby-regexp">//</span> <span class="ruby-identifier">small</span> <span class="ruby-identifier">cross</span> <span class="ruby-identifier">img</span>
                         <span class="ruby-identifier">delItemEl</span> = $(<span class="ruby-string">&#39;&lt;span/&gt;&#39;</span>, {
                             <span class="ruby-string">&#39;class&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ms-close-btn&#39;</span>
                         }).<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;json&#39;</span>, <span class="ruby-identifier">value</span>).<span class="ruby-identifier">appendTo</span>(<span class="ruby-identifier">selectedItemEl</span>);

                         <span class="ruby-identifier">delItemEl</span>.<span class="ruby-identifier">click</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">proxy</span>(<span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onTagTriggerClick</span>, <span class="ruby-identifier">ref</span>));
                     }
                 }

                 <span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">selectedItemEl</span>);
             });
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">prepend</span>(<span class="ruby-identifier">items</span>);

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">store</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">values</span>, <span class="ruby-identifier">behaviour</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">multiple</span> <span class="ruby-identifier">select</span>
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span> = $(<span class="ruby-string">&#39;&lt;div/&gt;&#39;</span>, {
                 <span class="ruby-identifier">style</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;display: none;&#39;</span>
             });
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getValue</span>(), <span class="ruby-identifier">function</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">val</span>){
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">el</span> = $(<span class="ruby-string">&#39;&lt;input/&gt;&#39;</span>, {
                     <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;hidden&#39;</span>,
                     <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">name</span>,
                     <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">val</span>
                 });
                 <span class="ruby-identifier">el</span>.<span class="ruby-identifier">appendTo</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span>);
             });
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">_valueContainer</span>.<span class="ruby-identifier">appendTo</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>);

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">width</span>(<span class="ruby-value">0</span>);
                 <span class="ruby-identifier">inputOffset</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">offset</span>().<span class="ruby-identifier">left</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">selectionContainer</span>.<span class="ruby-identifier">offset</span>().<span class="ruby-identifier">left</span>;
                 <span class="ruby-identifier">w</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">width</span>() <span class="ruby-operator">-</span> <span class="ruby-identifier">inputOffset</span> <span class="ruby-operator">-</span> <span class="ruby-value">42</span>;
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">width</span>(<span class="ruby-identifier">w</span>);
             }

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>){
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelectionRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span>));
             } <span class="ruby-keyword">else</span> {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>.<span class="ruby-identifier">hide</span>();
             }
         },

         <span class="ruby-regexp">/**
            Select an item either through keyboard or mouse
            @param item
            @private
           /</span>
         <span class="ruby-identifier">_selectItem</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">item</span>) {
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span> <span class="ruby-operator">===</span> <span class="ruby-value">1</span>){
                 <span class="ruby-identifier">_selection</span> = [];
             }
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">addToSelection</span>(<span class="ruby-identifier">item</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;json&#39;</span>));
             <span class="ruby-identifier">item</span>.<span class="ruby-identifier">removeClass</span>(<span class="ruby-string">&#39;ms-res-item-active&#39;</span>);
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expandOnFocus</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>){
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
             }
             <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">_hasFocus</span>){
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>();
             } <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_hasFocus</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expandOnFocus</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">_ctrlDown</span>)){
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_ctrlDown</span>){
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
                 }
             }
         },

         <span class="ruby-node">/**
            Sorts the results and cut them down to max # of displayed results at once
            @private
           /</span>
         <span class="ruby-identifier">_sortAndTrim</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">data</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">q</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>(),
                 <span class="ruby-identifier">filtered</span> = [],
                 <span class="ruby-identifier">newSuggestions</span> = [],
                 <span class="ruby-identifier">selectedValues</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getValue</span>();
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">filter</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">data</span> <span class="ruby-identifier">according</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">given</span> <span class="ruby-identifier">input</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">q</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                 <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">obj</span>) {
                     <span class="ruby-identifier">var</span> <span class="ruby-identifier">name</span> = <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>];
                     <span class="ruby-keyword">if</span>((<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">matchCase</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">indexOf</span>(<span class="ruby-identifier">q</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>) <span class="ruby-operator">||</span>
                         (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">matchCase</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">toLowerCase</span>().<span class="ruby-identifier">indexOf</span>(<span class="ruby-identifier">q</span>.<span class="ruby-identifier">toLowerCase</span>()) <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>)) {
                         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">strictSuggest</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">toLowerCase</span>().<span class="ruby-identifier">indexOf</span>(<span class="ruby-identifier">q</span>.<span class="ruby-identifier">toLowerCase</span>()) <span class="ruby-operator">===</span> <span class="ruby-value">0</span>) {
                             <span class="ruby-identifier">filtered</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">obj</span>);
                         }
                     }
                 });
             }
             <span class="ruby-keyword">else</span> {
                 <span class="ruby-identifier">filtered</span> = <span class="ruby-identifier">data</span>;
             }
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">take</span> <span class="ruby-identifier">out</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">ones</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">already</span> <span class="ruby-identifier">been</span> <span class="ruby-identifier">selected</span>
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">filtered</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">obj</span>) {
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$.</span><span class="ruby-identifier">inArray</span>(<span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>], <span class="ruby-identifier">selectedValues</span>) <span class="ruby-operator">===</span> <span class="ruby-value">-1</span>) {
                     <span class="ruby-identifier">newSuggestions</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">obj</span>);
                 }
             });
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">sort</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">data</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortOrder</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
                 <span class="ruby-identifier">newSuggestions</span>.<span class="ruby-identifier">sort</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span>) {
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortOrder</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortOrder</span>]) {
                         <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortDir</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;asc&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">-1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>;
                     }
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortOrder</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortOrder</span>]) {
                         <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">sortDir</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;asc&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>;
                     }
                     <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>;
                 });
             }
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">trim</span> <span class="ruby-identifier">it</span> <span class="ruby-identifier">down</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSuggestions</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSuggestions</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                 <span class="ruby-identifier">newSuggestions</span> = <span class="ruby-identifier">newSuggestions</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSuggestions</span>);
             }
             <span class="ruby-keyword">return</span> <span class="ruby-identifier">newSuggestions</span>;

         },

         <span class="ruby-identifier">_group</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">data</span>){
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">build</span> <span class="ruby-identifier">groups</span>
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">groupBy</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
                 <span class="ruby-identifier">_groups</span> = {};
                 <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">value</span>) {
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_groups</span>[<span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">groupBy</span>]] <span class="ruby-operator">===</span> <span class="ruby-identifier">undefined</span>) {
                         <span class="ruby-identifier">_groups</span>[<span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">groupBy</span>]] = {<span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">groupBy</span>], <span class="ruby-identifier">items</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">value</span>]};
                     }
                     <span class="ruby-keyword">else</span> {
                         <span class="ruby-identifier">_groups</span>[<span class="ruby-identifier">value</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">groupBy</span>]].<span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">value</span>);
                     }
                 });
             }
             <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>;
         },

         <span class="ruby-regexp">/**
            Update the helper text
            @private
           /</span>
         <span class="ruby-identifier">_updateHelper</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">html</span>) {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>.<span class="ruby-identifier">html</span>(<span class="ruby-identifier">html</span>);
             <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>.<span class="ruby-identifier">is</span>(<span class="ruby-string">&quot;:visible&quot;</span>)) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>.<span class="ruby-identifier">fadeIn</span>();
             }
         },

         <span class="ruby-regexp">/**
            Validate an item against vtype or vregex
            @private
           /</span>
         <span class="ruby-identifier">_validateSingleItem</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">value</span>){
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vregex</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vregex</span> <span class="ruby-identifier">instanceof</span> <span class="ruby-constant">RegExp</span>){
                 <span class="ruby-keyword">return</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vregex</span>.<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
             } <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vtype</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
                 <span class="ruby-identifier">switch</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">vtype</span>){
                     <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;alpha&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">return</span> (<span class="ruby-regexp">/^[a-zA-Z_]+$/</span>).<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
                     <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;alphanum&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">return</span> (<span class="ruby-regexp">/^[a-zA-Z0-9_]+$/</span>).<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
                     <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;email&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">return</span> (<span class="ruby-regexp">/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/</span>).<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
                     <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;url&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">return</span> (<span class="ruby-node">/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\/+@&amp;#;`~=%!]*)(\.\w{2,})?)*\/?)/i</span>).<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
                     <span class="ruby-keyword">case</span> <span class="ruby-string">&#39;ipaddress&#39;</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">return</span> (<span class="ruby-regexp">/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/</span>).<span class="ruby-identifier">test</span>(<span class="ruby-identifier">value</span>);
                 }
             }
             <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>;
         }
     };

     <span class="ruby-identifier">var</span> <span class="ruby-identifier">handlers</span> = {
         <span class="ruby-regexp">/**
            Triggered when blurring out of the component
            @private
           /</span>
         <span class="ruby-identifier">_onBlur</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">removeClass</span>(<span class="ruby-string">&#39;ms-ctn-focus&#39;</span>);
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
             <span class="ruby-identifier">_hasFocus</span> = <span class="ruby-keyword">false</span>;
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>() <span class="ruby-operator">!=</span>= <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">allowFreeEntries</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>){
                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">obj</span> = {};
                 <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>] = <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>] = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>().<span class="ruby-identifier">trim</span>();
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">addToSelection</span>(<span class="ruby-identifier">obj</span>);
             }
             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">isValid</span>() <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">addClass</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">invalidCls</span>);
             }

             <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>() <span class="ruby-operator">!=</span>= <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">allowFreeEntries</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">empty</span>();
                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-string">&#39;&#39;</span>);
             }

             $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;blur&#39;</span>, [<span class="ruby-identifier">ms</span>]);
         },

         <span class="ruby-regexp">/**
            Triggered when hovering an element in the combo
            @param e
            @private
           /</span>
         <span class="ruby-identifier">_onComboItemMouseOver</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">children</span>().<span class="ruby-identifier">removeClass</span>(<span class="ruby-string">&#39;ms-res-item-active&#39;</span>);
             $(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">currentTarget</span>).<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&#39;ms-res-item-active&#39;</span>);
         },

         <span class="ruby-regexp">/**
            Triggered when an item is chosen from the list
            @param e
            @private
           /</span>
         <span class="ruby-identifier">_onComboItemSelected</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_selectItem</span>($(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">currentTarget</span>));
         },

         <span class="ruby-regexp">/**
            Triggered when focusing on the container div. Will focus on the input field instead.
            @private
           /</span>
         <span class="ruby-identifier">_onFocus</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>();
         },

         <span class="ruby-regexp">/**
            Triggered when clicking on the input text field
            @private
           /</span>
         <span class="ruby-identifier">_onInputClick</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(){
             <span class="ruby-keyword">if</span> (<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">isDisabled</span>() <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">_hasFocus</span>) {
                 <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">toggleOnClick</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span>){
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
                     } <span class="ruby-keyword">else</span> {
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
                     }
                 }
             }
         },

         <span class="ruby-regexp">/**
            Triggered when focusing on the input text field.
            @private
           /</span>
         <span class="ruby-identifier">_onInputFocus</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">isDisabled</span>() <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">_hasFocus</span>) {
                 <span class="ruby-identifier">_hasFocus</span> = <span class="ruby-keyword">true</span>;
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">addClass</span>(<span class="ruby-string">&#39;ms-ctn-focus&#39;</span>);
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">removeClass</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">invalidCls</span>);

                 <span class="ruby-identifier">var</span> <span class="ruby-identifier">curLength</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>().<span class="ruby-identifier">length</span>;
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expandOnFocus</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>){
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
                 }

                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>) {
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelectionRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span>));
                 } <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">curLength</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span>) {
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minCharsRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">curLength</span>));
                 }

                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
                 $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;focus&#39;</span>, [<span class="ruby-identifier">ms</span>]);
             }
         },

         <span class="ruby-regexp">/**
            Triggered when the user presses a key while the component has focus
            This is where we want to handle all keys that don&#39;t require the user input field
            since it hasn&#39;t registered the key hit yet
            @param e keyEvent
            @private
           /</span>
         <span class="ruby-identifier">_onKeyDown</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">check</span> <span class="ruby-identifier">how</span> <span class="ruby-identifier">tab</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">handled</span>
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">active</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-res-item-active:first&#39;</span>),
                 <span class="ruby-identifier">freeInput</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>();
             $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;keydown&#39;</span>, [<span class="ruby-identifier">ms</span>, <span class="ruby-identifier">e</span>]);

             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">===</span> <span class="ruby-value">9</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">useTabKey</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span>
                 (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">useTabKey</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">active</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span>))) {
                 <span class="ruby-identifier">handlers</span>.<span class="ruby-identifier">_onBlur</span>();
                 <span class="ruby-keyword">return</span>;
             }
             <span class="ruby-identifier">switch</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span>) {
                 <span class="ruby-keyword">case</span> <span class="ruby-value">8</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span><span class="ruby-identifier">backspace</span>
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getSelection</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span>) {
                         <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">pop</span>();
                         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_renderSelection</span>();
                         $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;selectionchange&#39;</span>, [<span class="ruby-identifier">ms</span>, <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getSelection</span>()]);
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">attr</span>(<span class="ruby-string">&#39;placeholder&#39;</span>, (<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">selectionPosition</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;inner&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">getValue</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">placeholder</span>);
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>();
                         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     }
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-value">9</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">tab</span>
                 <span class="ruby-keyword">case</span> <span class="ruby-value">188</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">esc</span>
                 <span class="ruby-keyword">case</span> <span class="ruby-value">13</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">enter</span>
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-value">17</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">ctrl</span>
                     <span class="ruby-identifier">_ctrlDown</span> = <span class="ruby-keyword">true</span>;
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-value">40</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">down</span>
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_moveSelectedRow</span>(<span class="ruby-string">&quot;down&quot;</span>);
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-value">38</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">up</span>
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_moveSelectedRow</span>(<span class="ruby-string">&quot;up&quot;</span>);
                     <span class="ruby-keyword">break</span>;
                 <span class="ruby-identifier">default</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>) {
                         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     }
                     <span class="ruby-keyword">break</span>;
             }
         },

         <span class="ruby-regexp">/**
            Triggered when a key is released while the component has focus
            @param e
            @private
           /</span>
         <span class="ruby-identifier">_onKeyUp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
             <span class="ruby-identifier">var</span> <span class="ruby-identifier">freeInput</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>(),
                 <span class="ruby-identifier">inputValid</span> = <span class="ruby-identifier">$.</span><span class="ruby-identifier">trim</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>()).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
                     (<span class="ruby-operator">!</span><span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryLength</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$.</span><span class="ruby-identifier">trim</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">val</span>()).<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryLength</span>),
                 <span class="ruby-identifier">selected</span>,
                 <span class="ruby-identifier">obj</span> = {};

             $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;keyup&#39;</span>, [<span class="ruby-identifier">ms</span>, <span class="ruby-identifier">e</span>]);

             <span class="ruby-identifier">clearTimeout</span>(<span class="ruby-identifier">_timer</span>);

             <span class="ruby-regexp">//</span> <span class="ruby-identifier">collapse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span>, <span class="ruby-identifier">but</span> <span class="ruby-identifier">keep</span> <span class="ruby-identifier">focus</span>.
             <span class="ruby-identifier">if</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">===</span> <span class="ruby-value">27</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span>) {
                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">hide</span>();
             }
             <span class="ruby-regexp">//</span> <span class="ruby-identifier">ignore</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">bunch</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">keys</span>
             <span class="ruby-keyword">if</span>((<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">===</span> <span class="ruby-value">9</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">useTabKey</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">13</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">32</span>)) {
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">===</span> <span class="ruby-value">17</span>){
                     <span class="ruby-identifier">_ctrlDown</span> = <span class="ruby-keyword">false</span>;
                 }
                 <span class="ruby-keyword">return</span>;
             }
             <span class="ruby-identifier">switch</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span>) {
                 <span class="ruby-keyword">case</span> <span class="ruby-value">40</span><span class="ruby-operator">:</span><span class="ruby-keyword">case</span> <span class="ruby-value">38</span><span class="ruby-operator">:</span> <span class="ruby-regexp">//</span> <span class="ruby-identifier">up</span>, <span class="ruby-identifier">down</span>
                 <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                 <span class="ruby-keyword">break</span>;
                 <span class="ruby-keyword">case</span> <span class="ruby-value">13</span><span class="ruby-operator">:</span><span class="ruby-keyword">case</span> <span class="ruby-value">9</span><span class="ruby-operator">:</span><span class="ruby-keyword">case</span> <span class="ruby-value">188</span><span class="ruby-operator">:</span><span class="ruby-regexp">//</span> <span class="ruby-identifier">enter</span>, <span class="ruby-identifier">tab</span>, <span class="ruby-identifier">comma</span>
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">keyCode</span> <span class="ruby-operator">!=</span>= <span class="ruby-value">188</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">useCommaKey</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                     <span class="ruby-identifier">e</span>.<span class="ruby-identifier">preventDefault</span>();
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>){ <span class="ruby-regexp">//</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">selection</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">performed</span>, <span class="ruby-identifier">select</span> <span class="ruby-identifier">it</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">reset</span> <span class="ruby-identifier">field</span>
                         <span class="ruby-identifier">selected</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">combobox</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;.ms-res-item-active:first&#39;</span>);
                         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">selected</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_selectItem</span>(<span class="ruby-identifier">selected</span>);
                             <span class="ruby-keyword">return</span>;
                         }
                     }
                     <span class="ruby-regexp">//</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">no</span> <span class="ruby-identifier">selection</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">freetext</span> <span class="ruby-identifier">entered</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">free</span> <span class="ruby-identifier">entries</span> <span class="ruby-identifier">allowed</span>, <span class="ruby-identifier">add</span> <span class="ruby-identifier">new</span> <span class="ruby-identifier">obj</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">selection</span>
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">inputValid</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">allowFreeEntries</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                         <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">displayField</span>] = <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">valueField</span>] = <span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">trim</span>();
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">addToSelection</span>(<span class="ruby-identifier">obj</span>);
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>(); <span class="ruby-regexp">//</span> <span class="ruby-identifier">reset</span> <span class="ruby-identifier">combo</span> <span class="ruby-identifier">suggestions</span>
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>();
                     }
                     <span class="ruby-keyword">break</span>;
                 }
                 <span class="ruby-identifier">default</span><span class="ruby-operator">:</span>
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>){
                         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelectionRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span>));
                     }
                     <span class="ruby-keyword">else</span> {
                         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span>) {
                             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minCharsRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span>));
                             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
                             }
                         }
                         <span class="ruby-keyword">else</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryLength</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryLength</span>) {
                             <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxEntryLength</span>));
                             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                                 <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
                             }
                         }
                         <span class="ruby-keyword">else</span> {
                             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">helper</span>.<span class="ruby-identifier">hide</span>();
                             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">freeInput</span>.<span class="ruby-identifier">length</span>){
                                 <span class="ruby-identifier">_timer</span> = <span class="ruby-identifier">setTimeout</span>(<span class="ruby-identifier">function</span>() {
                                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                                         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_processSuggestions</span>();
                                     } <span class="ruby-keyword">else</span> {
                                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
                                     }
                                 }, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">typeDelay</span>);
                             }
                         }
                     }
                     <span class="ruby-keyword">break</span>;
             }
         },

         <span class="ruby-regexp">/**
            Triggered when clicking upon cross for deletion
            @param e
            @private
           /</span>
         <span class="ruby-identifier">_onTagTriggerClick</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">e</span>) {
             <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">removeFromSelection</span>($(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">currentTarget</span>).<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;json&#39;</span>));
         },

         <span class="ruby-regexp">/**
            Triggered when clicking on the small trigger in the right
            @private
           /</span>
         <span class="ruby-identifier">_onTriggerClick</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
             <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ms</span>.<span class="ruby-identifier">isDisabled</span>() <span class="ruby-operator">===</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expandOnFocus</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">_selection</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">maxSelection</span>)) {
                 $(<span class="ruby-identifier">ms</span>).<span class="ruby-identifier">trigger</span>(<span class="ruby-string">&#39;triggerclick&#39;</span>, [<span class="ruby-identifier">ms</span>]);
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">expanded</span> <span class="ruby-operator">===</span> <span class="ruby-keyword">true</span>) {
                     <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">collapse</span>();
                 } <span class="ruby-keyword">else</span> {
                     <span class="ruby-identifier">var</span> <span class="ruby-identifier">curLength</span> = <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">getRawValue</span>().<span class="ruby-identifier">length</span>;
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">curLength</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span>){
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">focus</span>();
                         <span class="ruby-identifier">ms</span>.<span class="ruby-identifier">expand</span>();
                     } <span class="ruby-keyword">else</span> {
                         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_updateHelper</span>(<span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minCharsRenderer</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">cfg</span>.<span class="ruby-identifier">minChars</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">curLength</span>));
                     }
                 }
             }
         }
     };

     <span class="ruby-regexp">//</span> <span class="ruby-identifier">startup</span> <span class="ruby-identifier">point</span>
     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">element</span> <span class="ruby-operator">!=</span>= <span class="ruby-identifier">null</span>) {
         <span class="ruby-keyword">self</span>.<span class="ruby-identifier">_render</span>(<span class="ruby-identifier">element</span>);
     }
 };

 <span class="ruby-identifier">$.</span><span class="ruby-identifier">fn</span>.<span class="ruby-identifier">magicSuggest</span> = <span class="ruby-identifier">function</span>(<span class="ruby-identifier">options</span>) {
     <span class="ruby-identifier">var</span> <span class="ruby-identifier">obj</span> = $(<span class="ruby-identifier">this</span>);

     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">size</span>() <span class="ruby-operator">===</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>)) {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>);
     }

     <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">i</span>) {
         <span class="ruby-regexp">//</span> <span class="ruby-identifier">assume</span> $(<span class="ruby-identifier">this</span>) <span class="ruby-identifier">is</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">element</span>
         <span class="ruby-identifier">var</span> <span class="ruby-identifier">cntr</span> = $(<span class="ruby-identifier">this</span>);

         <span class="ruby-regexp">//</span> <span class="ruby-constant">Return</span> <span class="ruby-identifier">early</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">this</span> <span class="ruby-identifier">element</span> <span class="ruby-identifier">already</span> <span class="ruby-identifier">has</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">plugin</span> <span class="ruby-identifier">instance</span>
         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">cntr</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>)){
             <span class="ruby-keyword">return</span>;
         }

         <span class="ruby-keyword">if</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">nodeName</span>.<span class="ruby-identifier">toLowerCase</span>() <span class="ruby-operator">===</span> <span class="ruby-string">&#39;select&#39;</span>){ <span class="ruby-regexp">//</span> <span class="ruby-identifier">rendering</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">select</span>
             <span class="ruby-identifier">options</span>.<span class="ruby-identifier">data</span> = [];
             <span class="ruby-identifier">options</span>.<span class="ruby-identifier">value</span> = [];
             <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">children</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">child</span>){
                 <span class="ruby-keyword">if</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">nodeName</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">nodeName</span>.<span class="ruby-identifier">toLowerCase</span>() <span class="ruby-operator">===</span> <span class="ruby-string">&#39;option&#39;</span>){
                     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">text</span>});
                     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">selected</span>){
                         <span class="ruby-identifier">options</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>);
                     }
                 }
             });
         }

         <span class="ruby-identifier">var</span> <span class="ruby-keyword">def</span> = {};
         <span class="ruby-regexp">//</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">values</span> <span class="ruby-identifier">from</span> <span class="ruby-constant">DOM</span> <span class="ruby-identifier">container</span> <span class="ruby-identifier">element</span>
         <span class="ruby-identifier">$.</span><span class="ruby-identifier">each</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">function</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">att</span>){
             <span class="ruby-keyword">def</span>[<span class="ruby-identifier">att</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">att</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">===</span> <span class="ruby-string">&#39;value&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">att</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span>= <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">att</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">att</span>.<span class="ruby-identifier">value</span>;
         });

         <span class="ruby-identifier">var</span> <span class="ruby-identifier">field</span> = <span class="ruby-identifier">new</span> <span class="ruby-constant">MagicSuggest</span>(<span class="ruby-identifier">this</span>, <span class="ruby-identifier">$.</span><span class="ruby-identifier">extend</span>([], <span class="ruby-identifier">$.</span><span class="ruby-identifier">fn</span>.<span class="ruby-identifier">magicSuggest</span>.<span class="ruby-identifier">defaults</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword">def</span>));
         <span class="ruby-identifier">cntr</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>, <span class="ruby-identifier">field</span>);
         <span class="ruby-identifier">field</span>.<span class="ruby-identifier">container</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>, <span class="ruby-identifier">field</span>);
     });

     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">size</span>() <span class="ruby-operator">===</span> <span class="ruby-value">1</span>) {
         <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">data</span>(<span class="ruby-string">&#39;magicSuggest&#39;</span>);
     }
     <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>;
 };

<span class="ruby-identifier">$.</span><span class="ruby-identifier">fn</span>.<span class="ruby-identifier">magicSuggest</span>.<span class="ruby-identifier">defaults</span> = {};
</pre>

<p>})(jQuery);</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

